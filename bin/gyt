#!/usr/bin/env ruby

require "gyt"
require "thor"

class GytCLI < Thor
  desc "init [PATH]", "Initialize new Gyt repository"
  def init
    Gyt::Repository.init(current_dir)
  end

  desc "add FILE, add DIRECTORY", "Add file to index"
  def add(filepath)
    repo = Gyt::Repository.new(current_dir)
    repo.add(filepath)
  end

  desc "status", "Show files to be committed"
  def status
    repo = Gyt::Repository.new(current_dir)
    repo.status
  end

  desc "commit", "Commit files to history"
  method_option :message, aliases: "-m", desc: "Commit message", required: true
  def commit
    repo = Gyt::Repository.new(current_dir)
    repo.commit!(options[:message])
  end

  desc "log", "Show commit history"
  def log
    repo = Gyt::Repository.new(current_dir)
    repo.log
  end

  no_commands do
    def current_dir
      File.expand_path('.')
    end
  end
end

GytCLI.start
